#
#  Network Traffic - https://storage.ptsecurity.com/d/7f387844efd84fbaac74/
#
######################### Bunitu.Proxy

alert tcp $HOME_NET any -> $EXTERNAL_NET [53, 443] (msg: "MALWARE [PTsecurity] Bunitu.Proxy pkt checker #0"; flow: established, to_server; dsize: 14; content: "|00|"; offset: 1; depth:1;  stream_size: server, =,1; stream_size: client, =,15; flowbits: noalert;flowbits: set, FB70820_0; classtype: trojan-activity; metadata: created_at 2017_8_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11000339; rev: 5;) 

alert tcp $EXTERNAL_NET [53, 443] -> $HOME_NET any (msg: "MALWARE [PTsecurity] Bunitu.Proxy pkt checker #1"; flow: established, to_client; dsize: 50; content: "|00|"; offset: 1; depth:1; stream_size: server, =,51; stream_size: client, =,15; flowbits: noalert; flowbits: isset, FB70820_0; flowbits: unset, FB70820_0; flowbits: set, FB70820_1; classtype: trojan-activity; metadata: created_at 2017_8_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11000340; rev: 4;) 

alert tcp $HOME_NET any -> $EXTERNAL_NET [53, 443] (msg: "MALWARE [PTsecurity] Bunitu.Proxy"; flow: established, to_server; dsize: 37; content: "|00|"; offset: 1; depth:1; stream_size: server, =, 51; stream_size: client, =,52; flowbits: isset, FB70820_1; classtype: trojan-activity; metadata: created_at 2017_8_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11000342; rev: 4;)


###################### Tofsee bot


alert tcp $EXTERNAL_NET !$HTTP_PORTS -> $HOME_NET any (msg: "MALWARE [PTsecurity] Tofsee.bot pkt200 connection"; flow: established, to_client; dsize:200; flags:PA; stream_size:client,=,1; stream_size:server,=,201; flowbits:noalert; flowbits:set, PT.Tofsee_0; classtype: trojan-activity; metadata: created_at 2017_6_2; reference: url, github.com/ptresearch/AttackDetection; sid: 11001386; rev: 2; )

alert tcp $EXTERNAL_NET !$HTTP_PORTS -> $HOME_NET any (msg: "MALWARE [PTsecurity] Tofsee.bot pkt57 connection"; flow: established, to_client; dsize:57; flags:PA; stream_size:client,<,200; stream_size:server,=,258; flowbits:isset, PT.Tofsee_0; flowbits:noalert; flowbits:unset, PT.Tofsee_0; flowbits:set, PT.Tofsee_1; classtype: trojan-activity; metadata: created_at 2017_6_2; reference: url, github.com/ptresearch/AttackDetection; sid: 11001388; rev: 2; )

alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] Tofsee.bot pkt97 sequence"; flow: established, to_server; dsize:97; flags:PA; stream_size:client,<,300; stream_size:server,=,258; flowbits:noalert; flowbits:isset, PT.Tofsee_1; flowbits:unset, PT.Tofsee_1; flowbits:set, PT.Tofsee_2; classtype: trojan-activity; metadata: created_at 2017_6_2; reference: url, github.com/ptresearch/AttackDetection; sid: 11001387; rev: 2; )

alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] Tofsee.bot connection detected"; flow: established, to_server; flowbits: isset,PT.Tofsee_2; dsize:25; flags:PA; stream_size:client,<,350; stream_size:server,=,258; classtype: trojan-activity; metadata: created_at 2017_6_2; reference: url, github.com/ptresearch/AttackDetection; sid: 11001385; rev: 2; )


###################### Bayrob (8-xx-2)

alert tcp $HOME_NET any -> $EXTERNAL_NET [20000:] (msg: "MALWARE [PTsecurity] Bayrob pkt sequence detected set";flow: established, to_server; flowbits:set,PT.Bayrob0; dsize:8; flags:PA;stream_size:client,=,9;flowbits:noalert; classtype: trojan-activity; metadata: created_at 2017_6_2; reference: url, github.com/ptresearch/AttackDetection; sid: 11001392; rev: 1;)

alert tcp $EXTERNAL_NET [20000:] -> $HOME_NET any (msg: "MALWARE [PTsecurity] Bayrob detected ";flow: established, to_client; flowbits:isset,PT.Bayrob0; dsize:2; flags:PA;stream_size:server,=,3;stream_size:client,<,400;flowbits:unset,PT.Bayrob0; classtype: trojan-activity; metadata: created_at 2017_6_2; reference: url, blog.fortinet.com/2016/07/27/bayrob-an-ancient-evil-awakens-ii; reference: url, github.com/ptresearch/AttackDetection; sid: 11001394; rev: 2;)


###################### TOR certificate starter (This rule is necessary for detecting any TOR network communications (Dyre, Tribot, Torrentlocker... etc)

alert tls  $EXTERNAL_NET any -> $HOME_NET any ( msg: "POLICY [PTsecurity] TOR cert set";  flow: established, to_client;  content: "|3082|"; depth: 300; content: "|308201|"; distance:2; within:3; content: "|a00302010202|"; distance:1; within:6; content: "|7777|"; distance:38; within:2; fast_pattern; flowbits: set, FB0_01; flowbits: noalert; classtype: misc-activity;  metadata: created_at 2017_8_24; reference: url, github.com/ptresearch/AttackDetection; sid: 11001844;  rev: 2; )

##################### TOR (TLS)

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content:"|00 21|"; distance:1; fast_pattern; within:2;  stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: set, FB0_0; flowbits: isset, FB0_01; flowbits: noalert; classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001460; rev: 3;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content:"|00 30|"; distance:1; within:2; fast_pattern; stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: set, FB0_0; flowbits: isset, FB0_01; flowbits: noalert; classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001842; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content:"|00 40|"; distance:1; within:2; fast_pattern; stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: set, FB0_0; flowbits: isset, FB0_01; flowbits: noalert; classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001843; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content:"|00 23|"; distance:1; within:2; fast_pattern; stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: noalert; flowbits: set, FB0_0; flowbits: isset, FB0_01;  classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11002145; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #1";flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,1420, 1, relative; byte_test: 2, <=,2096, 1, relative; stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: isset, FB0_0; flowbits: unset, FB0_0; flowbits: set, FB0_1; flowbits: noalert;  classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001461; rev: 6;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #2"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,538, 1, relative; byte_test: 2, <=,1052, 1, relative; stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: isset, FB0_1; flowbits: unset, FB0_1; flowbits: set, FB0_2; flowbits: noalert;  classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001462; rev: 3;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #3"; flow: established, to_client; content: "|1703 0302 1a|"; depth:5;stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: isset, FB0_2; flowbits: noalert; flowbits: unset, FB0_2; flowbits: set, FB0_3;  classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001463; rev: 3;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #3"; flow: established, to_client; content: "|1703|"; depth:2; content:"|02 40|"; distance:1; within:2; fast_pattern; stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: isset, FB0_2; flowbits: unset, FB0_2; flowbits: set, FB0_3; flowbits: noalert;  classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001845; rev: 3;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #3"; flow: established, to_client; content: "|1703|"; depth:2; content:"|02 30|"; distance:1; within:2; fast_pattern; stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: isset, FB0_2; flowbits: unset, FB0_2; flowbits: set, FB0_3; flowbits: noalert;  classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001846; rev: 3;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "POLICY [PTsecurity] TOR SSL connection"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,538, 1, relative; byte_test: 2, <=,4072, 1, relative; stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: isset, FB0_3; flowbits: unset, FB0_3; classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001464; rev: 3;) 


######################### Dyre/Trickbot/Dridex 
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex SSL connection pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,270, 1, relative; byte_test: 2, <=,292, 1, relative; stream_size: server, <,2710; stream_size: client, <,1540; flowbits: noalert; flowbits: set, FB314917_0; classtype: trojan-activity; metadata: created_at 2017_8_3; reference: url, github.com/ptresearch/AttackDetection; sid: 11001465; rev: 2;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex SSL connection pkt checker #1"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,400, 1, relative; byte_test: 2, <=,416, 1, relative; stream_size: server, <,2710; stream_size: client, <,1540;  flowbits: isset, FB314917_0; flowbits: unset, FB314917_0; flowbits: set, FB314917_1;  flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_8_3; reference: url, github.com/ptresearch/AttackDetection; sid: 11001466; rev: 2;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex SSL connection"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,400, 1, relative;  byte_test: 2, <=,416, 1, relative; stream_size: server, <,3300; stream_size: client, <,2500;  flowbits: isset, FB314917_1; flowbits: unset, FB314917_1; flowbits: set, FB314917_2; classtype: trojan-activity; metadata: created_at 2017_8_3; reference: url, github.com/ptresearch/AttackDetection; sid: 11001467; rev: 1;) 



################# Bayrob (last sample  Date: 01:44 12-02-2017)

alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] Bayrob pkt checker #0"; flow: established, to_server; dsize: 8; stream_size: server, =,1; stream_size: client, <,10; flowbits: noalert;flowbits: set, FB145313_0; classtype: trojan-activity; metadata: created_at 2017_7_12; reference: url, github.com/ptresearch/AttackDetection; sid: 11001517; rev: 1;)

alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] Bayrob pkt checker #1"; flow: established, to_server; dsize: 1; stream_size: server, =,1; stream_size: client, <,11; flowbits: noalert; flowbits: isset, FB145313_0; flowbits: unset, FB145313_0; flowbits: set, FB145313_1; classtype: trojan-activity; metadata: created_at 2017_7_12; reference: url, github.com/ptresearch/AttackDetection; sid: 11001518; rev: 1;) 

alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] Bayrob pkt checker #2"; flow: established, to_server; dsize: 2; stream_size: server, =,1; stream_size: client, <,13;  flowbits: noalert; flowbits: isset, FB145313_1; flowbits: unset, FB145313_1; flowbits: set, FB145313_2; classtype: trojan-activity; metadata: created_at 2017_7_12; reference: url, github.com/ptresearch/AttackDetection; sid: 11001519; rev: 1;) 

alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] Bayrob pkt checker #3"; flow: established, to_server; dsize: 2; stream_size: server, =,1; stream_size: client, <,15;  flowbits: noalert; flowbits: isset, FB145313_2; flowbits: unset, FB145313_2; flowbits: set, FB145313_3; classtype: trojan-activity; metadata: created_at 2017_7_12; reference: url, github.com/ptresearch/AttackDetection; sid: 11001520; rev: 1;) 

alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] Bayrob"; flow: established, to_server; dsize: 19; stream_size: server, <,21; stream_size: client, <,52; flowbits: isset, FB145313_3;  flowbits: unset, FB145313_3; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: created_at 2017_7_12; reference: url, github.com/ptresearch/AttackDetection; sid: 11001521; rev: 1;) 


#############################  AMMYY RAT 

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] AMMYY RAT pkt checker #0"; flow: established, to_server; content:"|3d|"; depth:1; dsize: 36; stream_size: server, =,1; stream_size: client, =,37; flowbits: noalert;flowbits: set, FB301822_0; classtype: misc-activity; metadata: created_at 2017_7_12; reference: url, github.com/ptresearch/AttackDetection; sid: 11001524; rev: 1;) 

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] AMMYY RAT pkt checker #1"; flow: established, to_client; content:"|2d00|"; depth:2; dsize: 2; stream_size: server, <,5; stream_size: client, <,39; flowbits: isset, FB301822_0; flowbits: unset, FB301822_0; threshold: type limit, track by_src, count 1, seconds 30; classtype: misc-activity; metadata: created_at 2017_7_12; reference: url, github.com/ptresearch/AttackDetection; sid: 11001525; rev: 1;) 



################################# Cybergate/Rebhip/Spyrat

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Cybergate/Rebhip/Spyrat pkt checker #0"; flow: established, to_server; dsize: 4; stream_size: server, =,1; stream_size: client, =,5; content:"|7c0a|"; depth:4; fast_pattern; flowbits: set, FB117960_0; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_7_13; reference: url, github.com/ptresearch/AttackDetection; sid: 11001527; rev: 1;) 

alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] Cybergate/Rebhip/Spyrat pkt checker #1"; flow: established, to_server; dsize: 27<>40; stream_size: server, =,1; stream_size: client, <,46; flowbits: isset, FB117960_0;  flowbits: unset, FB117960_0; flowbits: set, FB117960_1; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_7_13; reference: url, github.com/ptresearch/AttackDetection; sid: 11001528; rev: 2;) 

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Cybergate/Rebhip/Spyrat pkt checker #2"; flow: established, to_client; dsize: 3; content:"|0d0a|"; fast_pattern; stream_size: server, >,0; stream_size: client, >,0; stream_size: server, <,5; stream_size: client, <,46; flowbits: isset, FB117960_1; flowbits: unset, FB117960_1; flowbits: set, FB117960_2; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_7_13; reference: url, github.com/ptresearch/AttackDetection; sid: 11001529; rev: 2;) 

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Cybergate/Rebhip/Spyrat pkt checker #3"; flow: established, to_server; dsize: 1; content:"|0a|"; fast_pattern; depth:1; stream_size: server, >,0; stream_size: client, >,0; stream_size: server, <,5; stream_size: client, <,47; flowbits: isset, FB117960_2; flowbits: unset, FB117960_2; flowbits: set, FB117960_3; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_7_13; reference: url, github.com/ptresearch/AttackDetection; sid: 11001530; rev: 2;) 

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Cybergate/Rebhip/Spyrat Backdoor"; flow: established, to_client; dsize: 69<>80; content:"|0d0a|"; fast_pattern; stream_size: server, >,0; stream_size: client, >,0; stream_size: server, <,200; stream_size: client, <,200; flowbits: isset, FB117960_3; flowbits: unset, FB117960_3; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: created_at 2017_7_13; reference: url, github.com/ptresearch/AttackDetection; sid: 11001531; rev: 2;)



############################# Win32/Spy.Ursnif SSL TOR (The TOR cert rule is necessary)
# for use on high-performance sensors, or sandboxes traffic playback
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious TOR activity (Spy.Ursnif/Androm seen) pkt checker #0"; flow: established, to_server; content: "|1703 0100 20|"; fast_pattern; depth:5; content: "|1703 0100 20|"; distance:32; within: 5;  stream_size: server, >,1063; stream_size: client, >,429; stream_size: server, <,3156; stream_size: client, <,2261; flowbits: noalert; flowbits: isset, FB0_01; flowbits: set, FB167479_0; classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11001533; rev: 4;) 

# for use on high-performance sensors, or sandboxes traffic playback
alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Malicious TOR activity (Spy.Ursnif/Androm seen) pkt checker #1"; flow: established, to_client; content: "|17 03 01 00 20|"; fast_pattern; depth:5; content: "|1703|"; distance:32; within: 2; stream_size: server, >,2523; stream_size: client, >,429; stream_size: server, <,4000; stream_size: client, <,2261; flowbits: noalert; flowbits: isset, FB167479_0; flowbits: unset, FB167479_0; flowbits: set, FB167479_1; classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11001540; rev: 3;)

# for use on high-performance sensors, or sandboxes traffic playback
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious TOR activity (Spy.Ursnif/Androm seen) pkt checker #2"; flow: established, to_server; content: "|17 03 01 00 20|"; fast_pattern; depth:5; content: "|1703|"; distance:32; within: 2; stream_size: server, >,3153; stream_size: client, >,1015; stream_size: server, <,4100; stream_size: client, <,2261;  flowbits: noalert;  flowbits: isset, FB167479_1; flowbits: unset, FB167479_1; flowbits: set, FB167479_2;  classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11001541; rev: 4; ) 

# for use on high-performance sensors, or sandboxes traffic playback
alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Malicious TOR activity (Spy.Ursnif/Androm seen) pkt checker #3"; flow: established, to_client; content: "|17 03 01 00 20|"; fast_pattern; depth:5; content: "|1703|"; distance:32; within: 2; stream_size: server, >,3739; stream_size: client, >,1601; stream_size: server, <,4856; stream_size: client, <,2261; flowbits: noalert;  flowbits: isset, FB167479_2; flowbits: unset, FB167479_2; flowbits: set, FB167479_3; classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11001542; rev: 3; ) 

# for use on high-performance sensors, or sandboxes traffic playback
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious TOR activity (Spy.Ursnif/Androm seen)"; flow: established, to_server; content: "|17 03 01 00 20|"; fast_pattern; depth:5; content: "|1703|"; distance:32; within: 2; stream_size: server, >,3739; stream_size: client, >,2187; stream_size: server, <,5000; stream_size: client, <,5000; flowbits: isset, FB167479_3; flowbits: unset, FB167479_3; classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11001543; rev: 3; ) 



################################ Win32/Spy.Ursnif SSL (self signed cert)

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Win32/Spy.Ursnif.BK SSL connection pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0130|"; distance:1; within:2; fast_pattern;stream_size: server, >,928; stream_size: server, <,1998; stream_size: client, >,662; stream_size: client, <,1540; flowbits: set, FB391441_0; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_11_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002231; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Win32/Spy.Ursnif.BK SSL connection pkt checker #1"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,320, 1, relative; byte_test: 2, <=,336, 1, relative; stream_size: server, >,928; stream_size: server, <,1998; stream_size: client, >,1003; stream_size: client, <,1540;  flowbits: isset, FB391441_0; flowbits: unset, FB391441_0; flowbits: set, FB391441_1; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_11_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002232; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Win32/Spy.Ursnif.BK SSL connection"; flow: established, to_client; content: "|1703|"; depth:2; content: "|01B0|"; distance:1; within:2; fast_pattern;stream_size: server, >,1365; stream_size: server, <,2430; stream_size: client, >,1003; stream_size: client, <,1972; flowbits: isset, FB391441_1; flowbits: unset, FB391441_1; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2017_11_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002233; rev: 1;) 




########################## TorrentLocker TOR

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TorrentLocker pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; stream_size: server, <,3116; stream_size: client, <,2089; flowbits: noalert;flowbits: set, FB90331_0; classtype: trojan-activity; metadata: created_at 2017_7_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11001535; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] TorrentLocker pkt checker #1"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; stream_size: server, <,3116; stream_size: client, <,2089; flowbits: noalert; flowbits: isset, FB90331_0; flowbits: unset, FB90331_0; flowbits: set, FB90331_1; classtype: trojan-activity; metadata: created_at 2017_7_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11001536; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TorrentLocker pkt checker #2"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; stream_size: server, <,3116; stream_size: client, <,2089; flowbits: noalert; flowbits: isset, FB90331_1; flowbits: unset, FB90331_1; flowbits: set, FB90331_2; classtype: trojan-activity; metadata: created_at 2017_7_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11001537; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] TorrentLocker pkt checker #3"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; stream_size: server, <,3116; stream_size: client, <,2089; flowbits: noalert; flowbits: isset, FB90331_2; flowbits: unset, FB90331_2; flowbits: set, FB90331_3; classtype: trojan-activity; metadata: created_at 2017_7_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11001538; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TorrentLocker"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; stream_size: server, <,3140; stream_size: client, <,2113; flowbits: isset, FB90331_3; flowbits: unset, FB90331_3; classtype: misc-activity; metadata: created_at 2017_7_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11001539; rev: 1;) 




#############################  TorrentLocker TOR SSL v2 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TorrentLocker TOR SSL pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; stream_size: server, <,3113; stream_size: client, <,404; flowbits: noalert; flowbits: set, FB251545_0; classtype: trojan-activity; metadata: created_at 2017_7_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11001614; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TorrentLocker TOR SSL pkt checker #1"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, =,32, 1, relative; stream_size: server, <,3114; stream_size: client, <,404; flowbits: noalert; flowbits: isset, FB251545_0; flowbits: unset, FB251545_0; flowbits: set, FB251545_1; classtype: trojan-activity; metadata: created_at 2017_7_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11001615; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] TorrentLocker TOR SSL pkt checker #2"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; content: "|1703|"; distance:0; stream_size: server, <,3114; stream_size: client, <,404; flowbits: noalert; flowbits: isset, FB251545_1; flowbits: unset, FB251545_1; flowbits: set, FB251545_2; classtype: trojan-activity; metadata: created_at 2017_7_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11001616; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TorrentLocker TOR SSL pkt checker #3"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; stream_size: server, <,3114; stream_size: client, <,1704; flowbits: noalert; flowbits: isset, FB251545_2; flowbits: unset, FB251545_2; flowbits: set, FB251545_3; classtype: trojan-activity; metadata: created_at 2017_7_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11001617; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] TorrentLocker TOR SSL pkt check #4"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; content: "|1703|"; distance:0; stream_size: server, <,3137; stream_size: client, <,2001; flowbits: isset, FB251545_3; flowbits: unset, FB251545_3; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2017_7_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11001618; rev: 1;) 


##############################  Backdor.W32/Virut

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut pkt checker #0"; flow: established, to_server; dsize: 20; stream_size: server, =,1; stream_size: client, <,22; flowbits: noalert;flowbits: set, FB303766_0; classtype: trojan-activity; metadata: created_at 2017_7_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11001554; rev: 1;) 

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut pkt checker #1"; flow: established, to_server; dsize: 43; stream_size: server, =,1; stream_size: client, <,65; flowbits: noalert; flowbits: isset, FB303766_0; flowbits: unset, FB303766_0; flowbits: set, FB303766_1; classtype: trojan-activity; metadata: created_at 2017_7_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11001555; rev: 1;) 

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut pkt checker #2"; flow: established, to_server; dsize: 7; stream_size: server, =,1; stream_size: client, <,72; flowbits: noalert; flowbits: isset, FB303766_1; flowbits: unset, FB303766_1; flowbits: set, FB303766_2; classtype: trojan-activity; metadata: created_at 2017_7_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11001556; rev: 1;) 

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut"; flow: established, to_client; dsize: 105; stream_size: server, <,109; stream_size: client, <,82; flowbits: isset, FB303766_2; flowbits: unset, FB303766_2; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: created_at 2017_7_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11001557; rev: 2;)


########################## Backdor.W32/Virut

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut pkt checker #0";flow: established, to_server; dsize: 20; stream_size: server, =,1; stream_size: client, <,22;flowbits: noalert; flowbits: set, FB309156_0;classtype: trojan-activity; metadata: created_at 2017_7_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11001606;rev: 1;)

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut";flow: established, to_client;dsize: 68; stream_size: server, <,138;stream_size: client, <,137;flowbits: isset, FB309156_0;flowbits: unset, FB309156_0;threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity;metadata: created_at 2017_7_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11001607;rev: 2;) 


##############################  Backdor.W32/Virut

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut pkt checker #0"; flow: established, to_server; dsize: 20; stream_size: server, =,1; stream_size: client, <,22; flowbits: set, FB303766_0; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_7_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002261; rev: 1;) 

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut pkt checker #1"; flow: established, to_server; dsize: 40; stream_size: server, =,1; stream_size: client, <,65;  flowbits: isset, FB303766_0; flowbits: unset, FB303766_0; flowbits: set, FB303766_1; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_7_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002262; rev: 1;) 

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut pkt checker #2"; flow: established, to_client; dsize: 300<>400; stream_size: server, <,409; stream_size: client, <,82; flowbits: isset, FB303766_1;  flowbits: unset, FB303766_1; flowbits: set, FB303766_2; flowbits: noalert; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: created_at 2017_7_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002263; rev: 1;)

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut"; flow: established, to_server; dsize: <13; stream_size: server, <,400; stream_size: client, <,90;  flowbits: isset, FB303766_2; flowbits: unset, FB303766_2;  classtype: trojan-activity; metadata: created_at 2017_7_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002264; rev: 2;)

###################### Telegram Messenger v1  
#alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (msg: "POLICY [PTsecurity] Telegram Messenger v1 pkt checker #0"; flow: established, to_server; dsize: 89; stream_size: client, <,800; flowbits: noalert; flowbits: set, FB_Telegram_0; classtype: trojan-activity; metadata: created_at 2017_7_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11001578; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (msg: "POLICY [PTsecurity] Telegram Messenger v1 pkt checker #1"; flow: established, to_server; dsize: 89; stream_size: client, <,1500; flowbits: noalert; flowbits: isset, FB_Telegram_0; flowbits: unset, FB_Telegram_0; flowbits: set, FB_Telegram_1; classtype: trojan-activity; created_at 2017_7_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11001579; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (msg: "POLICY [PTsecurity] Telegram Messenger v1 pkt checker #2"; flow: established, to_server; dsize: 89; stream_size: client, <,2200; flowbits: noalert; flowbits: isset, FB_Telegram_1; flowbits: unset, FB_Telegram_1; flowbits: set, FB_Telegram_2; classtype: trojan-activity; metadata: created_at 2017_7_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11001580; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (msg: "POLICY [PTsecurity] Telegram Messenger v1 pkt checker #3"; flow: established, to_server; dsize: 89; stream_size: client, <,2200; flowbits: noalert; flowbits: isset, FB_Telegram_2; flowbits: unset, FB_Telegram_2; flowbits: set, FB_Telegram_3; classtype: trojan-activity; metadata: created_at 2017_7_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11001581; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (msg: "POLICY [PTsecurity] Telegram Messenger"; flow: established, to_server; dsize: 89; stream_size: client, <,2700; flowbits: isset, FB_Telegram_3; flowbits: unset, FB_Telegram_3; threshold: type limit, track by_src, count 1, seconds 300; classtype: misc-activity; metadata: created_at 2017_7_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11001582; rev: 1;) 


##########################  Linux/BillGates 

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Linux/BillGates pkt checker #0"; flow: established, to_server; dsize: 103<>106; stream_size: server, =,1; stream_size: client, <,107; flowbits: noalert;flowbits: set, FB79535_0; classtype: trojan-activity; metadata: created_at 2017_7_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11001602; rev: 1;) 

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Linux/BillGates pkt checker #1"; flow: established, to_client; dsize: 20; stream_size: server, <,22; stream_size: client, <,107; flowbits: noalert; flowbits: isset, FB79535_0; flowbits: unset, FB79535_0; flowbits: set, FB79535_1; classtype: trojan-activity; metadata: created_at 2017_7_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11001603; rev: 1;) 

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Linux/BillGates pkt checker #2"; flow: established, to_server; dsize: 39<>48; stream_size: server, <,22; stream_size: client, <,154; flowbits: noalert; flowbits: isset, FB79535_1; flowbits: unset, FB79535_1; flowbits: set, FB79535_2; classtype: trojan-activity; metadata: created_at 2017_7_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11001604; rev: 1;) 

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Linux/BillGates"; flow: established, to_client; dsize: 1<>9; stream_size: server, <,31; stream_size: client, <,155; flowbits: isset, FB79535_2; flowbits: unset, FB79535_2; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: created_at 2017_7_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11001605; rev: 1;) 


###############################  REMCOS
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE [PTsecurity] REMCOS pkt checker 0";flow:established, to_server; dsize:200<>910;stream_size:client,>,200;stream_size:client, <,911;stream_size:server,=,1;flowbits:set,FB180732_0; flowbits: noalert; metadata: former_category TROJAN;classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11003611; rev:6;metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_11, malware_family Remcos, performance_impact Moderate, updated_at 2017_10_12;)

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE [PTsecurity] REMCOS pkt checker 1"; flow:established, to_client; dsize:25<>35; stream_size:server,<,35; stream_size:server,>,25; stream_size:client,>,200; stream_size:client,<,911; flowbits:isset,FB180732_0; flowbits:unset, FB180732_0; flowbits:set,FB180732_1; flowbits: noalert; metadata: former_category TROJAN; classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11003612; rev:6; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_11, malware_family Remcos, performance_impact Moderate, updated_at 2017_10_12;)

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE [PTsecurity] REMCOS pkt checker 2"; flow:established, to_server; dsize:42<>270; stream_size:server, <,35;stream_size:server, >,25; stream_size:client, >,246; stream_size:client, <,1210; flowbits:isset, FB180732_1; flowbits:unset,FB180732_1; flowbits:set,FB180732_2; flowbits: noalert; metadata: former_category TROJAN;classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11003613; rev:10;metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_11, malware_family Remcos, performance_impact Significant, updated_at 2018_04_11;)

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE [PTsecurity] REMCOS pkt checker 3"; flow:established, to_client; dsize:25<>200; stream_size:server, <,200; stream_size:server, >,50; stream_size:client, <,1220; stream_size:client, >,200; flowbits:isset, FB180732_2; flowbits:unset, FB180732_2; flowbits:set, FB180732_3; flowbits: noalert; metadata: former_category TROJAN; classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11003614; rev:7; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_11, malware_family Remcos, performance_impact Moderate, updated_at 2017_10_12;)

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE [PTsecurity] Backdoor.Win32/Remcos RAT connection";flow:established, to_server;dsize:44<>270;stream_size:server,<,200;stream_size:server,>,50;stream_size:client,<,1400;stream_size:client,>,200;flowbits:isset,FB180732_3;flowbits:unset,FB180732_3; threshold:type limit,track by_src,count 1, seconds 30;metadata: former_category TROJAN; reference:url,blog.fortinet.com/2017/02/14/remcos-a-new-rat-in-the-wild-2;classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11003615;rev:8;metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_11, malware_family Remcos, performance_impact Moderate, updated_at 2018_04_11;)


###################### Dridex/Feodo SSL 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo-D SSL pkt checker #0.1"; flow: established, to_server; content: "|17 03 01 00 80|"; depth:5; stream_size: server, <,1905; stream_size: client, <,9911; stream_size: client, >,0; stream_size: server, >,0; flowbits: noalert;flowbits: set, FB313831_0; classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 11001683; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo SSL pkt checker #0.2"; flow: established, to_server; content: "|17 03 01 00 90|"; depth:5; stream_size: server, <,1905; stream_size: client, <,9911; stream_size: client, >,0; stream_size: server, >,0; flowbits: noalert;flowbits: set, FB313831_0; classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 11001684; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo SSL pkt checker #1"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,2512, 1, relative; byte_test: 2, <=,7900, 1, relative; stream_size: server, <,1905; stream_size: client, <,9911; stream_size: client, >,0; stream_size: server, >,0; flowbits: noalert; flowbits: isset, FB313831_0; flowbits: unset, FB313831_0; flowbits: set, FB313831_1; classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 11001685; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo SSL pkt checker #2.1"; flow: established, to_client; content: "|17 03 01 01 60|"; depth:5; stream_size: server, <,2257; stream_size: client, <,10263; stream_size: client, >,0; stream_size: server, >,0; flowbits: isset, FB313831_1; flowbits: unset, FB313831_1; threshold: type limit, track by_src, count 1, seconds 300;classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 11001686; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo SSL pkt checker #2.2"; flow: established, to_client; content: "|17 03 01 00 D0|"; depth:5; stream_size: server, <,2257; stream_size: client, <,10263; stream_size: client, >,0; stream_size: server, >,0; flowbits: isset, FB313831_1; flowbits: unset, FB313831_1; threshold: type limit, track by_src, count 1, seconds 300;classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 11001792; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo SSL"; flow: established, to_client; content: "|17 03 01 00 C0|"; depth:5; stream_size: server, <,2257; stream_size: client, <,10263; stream_size: client, >,0; stream_size: server, >,0; flowbits: isset, FB313831_1; flowbits: unset, FB313831_1; threshold: type limit, track by_src, count 1, seconds 300;classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 11001793; rev: 1;) 


######################  RevCode SSL connection

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] RevCode SSL connection pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0110|"; distance:1; within:2; fast_pattern;stream_size: server, >,1310; stream_size: server, <,7014; stream_size: client, >,433; stream_size: client, <,1460; flowbits: noalert; flowbits: set, FB375151_0; classtype: trojan-activity; metadata: created_at 2017_10_27; reference: url, github.com/ptresearch/AttackDetection; sid: 11002165; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] RevCode SSL connection pkt checker #1"; flow: established, to_server; content: "|1703|"; depth:2; content: "|00D0|"; distance:1; within:2; fast_pattern;stream_size: server, >,1310; stream_size: server, <,7014; stream_size: client, >,646; stream_size: client, <,1460; flowbits: noalert; flowbits: isset, FB375151_0; flowbits: unset, FB375151_0; flowbits: set, FB375151_1; classtype: trojan-activity; metadata: created_at 2017_10_27; reference: url, github.com/ptresearch/AttackDetection; sid: 11002166; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] RevCode SSL connection pkt checker #2"; flow: established, to_client; content: "|1703|"; depth:2; content: "|0180|"; distance:1; within:2; fast_pattern;stream_size: server, >,1599; stream_size: server, <,7014; stream_size: client, >,646; stream_size: client, <,1560; flowbits: isset, FB375151_1; flowbits: unset, FB375151_1; flowbits: set, FB375151_2; classtype: trojan-activity; metadata: created_at 2017_10_27; reference: url, github.com/ptresearch/AttackDetection; sid: 11002167; rev: 1;) 


###########################  Trojan.Agent/Trickbot/Gen-Upatre/Dyre/Dridex

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Trojan.Agent/Trickbot/Gen-Upatre/Dyre/Dridex pkt checker #1"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,160, 1, relative; byte_test: 2, <=,240, 1, relative; stream_size: server, <,3000; stream_size: client, <,3000; flowbits: noalert; flowbits: set, FB320221_0; classtype: trojan-activity; metadata: created_at 2017_8_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11001758; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Trojan.Agent/Trickbot/Gen-Upatre/Dyre/Dridex pkt checker #2";flow: established, to_client;content: "|17 03 01 00 F0|";depth:5;content: "|17 03 01  00 20|";distance:240;within:5;content: "|17 03 01|";distance:32;within:3;stream_size: server, <,30000;stream_size: client, <,30000;flowbits: isset, FB320221_0; flowbits: unset, FB320221_0; flowbits: set, FB320221_1; flowbits: noalert ; classtype: trojan-activity;metadata: created_at 2017_8_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11001759;rev: 2;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Trojan.Agent/Trickbot/Gen-Upatre/Dyre/Dridex #3";flow: established, to_client;content: "|17 03 01 01 00|"; depth:5; content: "|17 03 01  00 20|"; distance:256; within:5; content: "|17 03 01|";distance:32;within:3;stream_size: server, <,30000;stream_size: client, <,30000;flowbits: isset, FB320221_0; flowbits: unset, FB320221_0; flowbits: set, FB320221_1; classtype: trojan-activity;metadata: created_at 2017_8_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11001760;rev: 1;) 


#######################  Dropbox SSL Payload Request (This rules wrote for suspicious dropbox downloading based on first request header length)
alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "SUSPICIOUS [PTsecurity] Dropbox SSL Payload Request pkt checker #0"; flow: established, to_client; content: "|1603 01|"; depth:3;  content:  "www.dropbox.com0";  distance:0; within: 2044; fast_pattern; stream_size: server, <,2045;stream_size: client, >,0; stream_size: server, >,0; stream_size: client, <,300; flowbits: noalert; flowbits: set, FB309001_0; threshold: type limit, track by_src, count 1, seconds 30; classtype: misc-activity; metadata: created_at 2017_8_8; reference: url, github.com/ptresearch/AttackDetection; sid: 11001732; rev: 1; ) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "SUSPICIOUS [PTsecurity] Dropbox SSL Payload Request 416  pkt checker #0"; flow: established, to_client; content: "|1603 01|"; depth:3;  content:  ".dl.dropboxusercontent.com0";  distance:0; within: 2044; fast_pattern; stream_size: server, <,2045;stream_size: client, >,0; stream_size: server, >,0; stream_size: client, <,300;  flowbits: noalert; flowbits: set, FB309001_0; threshold: type limit, track by_src, count 1, seconds 30; classtype: misc-activity; metadata: created_at 2017_8_8; reference: url, github.com/ptresearch/AttackDetection; sid: 11001737; rev: 1; ) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "SUSPICIOUS [PTsecurity] Dropbox SSL Payload Request"; flow: established, to_server; content: "|1703 0100 80|"; depth:5; fast_pattern; content: !"|1703|";  distance:128;  within: 2; stream_size: server, <,5891;stream_size: client, >,0; stream_size: server, >,0; stream_size: client, <,514; flowbits: isset, FB309001_0; flowbits: unset, FB309001_0; flowbits: set, FB309001_1; classtype: misc-activity; metadata: created_at 2017_8_8; reference: url, github.com/ptresearch/AttackDetection; sid: 11001733; rev: 1;  )

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "SUSPICIOUS [PTsecurity] Dropbox SSL Payload Request"; flow: established, to_server; content: "|1703 0100 90|"; depth:5; fast_pattern; content: !"|1703|"; distance:144; within: 2;  stream_size: server, <,5891;stream_size: client, >,0; stream_size: server, >,0; stream_size: client, <,1014;  flowbits: isset, FB309001_0;  flowbits: unset, FB309001_0;  flowbits: set, FB309001_1; classtype: misc-activity; metadata: created_at 2017_8_8; reference: url, github.com/ptresearch/AttackDetection; sid: 11001734; rev: 1; )

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "SUSPICIOUS [PTsecurity] Dropbox SSL Payload Request"; flow: established, to_server; content: "|1703 0101 70|"; depth:5; fast_pattern; content: !"|1703|"; distance:368; within: 2;  stream_size: server, <,5891;stream_size: client, >,0; stream_size: server, >,0; stream_size: client, <,1014;  flowbits: isset, FB309001_0;  flowbits: unset, FB309001_0;  flowbits: set, FB309001_1; classtype: misc-activity; metadata: created_at 2017_8_8; reference: url, github.com/ptresearch/AttackDetection; sid: 11001735; rev: 1; )

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "SUSPICIOUS [PTsecurity] Dropbox SSL Payload Request";  flow: established, to_server;  content: "|1703 0102 00|";  depth:5; fast_pattern; content: !"|1703|"; distance:512; within: 2; stream_size: server, <,5891;stream_size: client, >,0; stream_size: server, >,0;  stream_size: client, <,1014; flowbits: isset, FB309001_0; flowbits: unset, FB309001_0; flowbits: set, FB309001_1;  classtype: misc-activity;  metadata: created_at 2017_8_8;  reference: url, github.com/ptresearch/AttackDetection; sid: 11001736;  rev: 1; )

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "SUSPICIOUS [PTsecurity] Dropbox SSL Payload Request"; flow: established, to_server; content: "|1703 0101 A0|"; depth:5; fast_pattern; flowbits: isset, FB309001_0;  flowbits: unset, FB309001_0;  flowbits: set, FB309001_1; classtype: misc-activity; metadata: created_at 2017_8_8; reference: url, github.com/ptresearch/AttackDetection; sid: 11001738; rev: 1;)


#########################  Babylon RAT 

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Babylon RAT pkt checker #0";flow: established, to_client;dsize: 4;content: "|FF|";offset:1;depth:1;stream_size: server, >,0;stream_size: server, <,30;stream_size: client, >,0;stream_size: client, <,160; flowbits: noalert; flowbits: set, FB322496_0;classtype: trojan-activity;metadata: created_at 2017_8_15; reference: url, github.com/ptresearch/AttackDetection; sid: 11001783;rev: 1;) 

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Babylon RAT pkt checker #1";flow: established, to_client;dsize: 8;content: "|FF|";offset:1;depth:1;stream_size: server, >,8;stream_size: server, <,130;stream_size: client, >,160;stream_size: client, <,300; flowbits: noalert; flowbits: isset, FB322496_0; flowbits: set, FB322496_1; flowbits: unset, FB322496_0; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity;metadata: created_at 2017_8_15; reference: url, github.com/ptresearch/AttackDetection; sid: 11001784;rev: 1;)

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Babylon RAT C2 conversation pkt checker #2";  flow: established, to_server;  dsize: 4;  content: "|FF|"; offset:1; depth:1;  stream_size: server, >,26;  stream_size: server, <,100;  stream_size: client, >,246;  stream_size: client, <,500;  flowbits: isset, FB322496_1;  flowbits: unset, FB322496_1;  classtype: trojan-activity;  metadata: created_at 2017_8_15;  reference: url, github.com/ptresearch/AttackDetection; sid: 11001785;  rev: 1; )  

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Babylon RAT C2 Client Request";flow: established, to_server; dsize:4; content:"|bdff 9eff|"; depth: 4; flowbits:set, PT.Babylon.RAT.Request;classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11000314; rev: 1;)

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Babylon RAT C2 Server Response";flow: established, to_client; flowbits:isset, PT.Babylon.RAT.Request;dsize:4;content:"|c5ff 9eff|"; depth: 4; flowbits:unset, PT.Babylon.RAT.Request;classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11000315; rev: 1;)

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Babylon RAT unset";flow: established, to_client; flowbits:isset, PT.Babylon.RAT.Request;content:!"|c5ff 9eff|"; depth: 4; flowbits:unset, PT.Babylon.RAT.Request; flowbits: noalert; classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11000316; rev: 1;)

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Babylon RAT (Dodiw.A VT) Check-in";flow: established, to_server, only_stream; content:!"|ff|";offset: 0; depth: 1;content: "|ff|";fast_pattern;offset: 1; depth: 1;content:!"|ff|";offset: 2; depth: 1; content: "|ff|";offset: 3; depth: 1; content:!"|ff|";offset: 4; depth: 1;pcre: "/^(.\xff.\xff).\xff.\xff\1(?!\1)/";pcre: "/^(?:.\xff){32}/";isdataat:!256;classtype: trojan-activity; metadata: created_at 2017_2_2; reference: url, github.com/ptresearch/AttackDetection; sid: 11000978; rev: 2;)

#########################  RemoteAdmin.RemoteUtilities 

alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] RemoteAdmin.RemoteUtilities pkt checker #0"; flow: established, to_server; dsize: 4; content: "|0000|"; depth:2; stream_size: server, >,0; stream_size: server, <,2; stream_size: client, >,0; stream_size: client, <,6; flowbits: noalert;flowbits: set, FB206141_0; classtype: trojan-activity; metadata: created_at 2017_8_29; reference: url, github.com/ptresearch/AttackDetection; sid: 11001881; rev: 1;) 

alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] RemoteAdmin.RemoteUtilities pkt checker #1"; flow: established, to_server; dsize: 4;  content: "|0000|"; depth:2; stream_size: server, >,0; stream_size: server, <,2; stream_size: client, >,0; stream_size: client, <,10; flowbits: noalert; flowbits: isset, FB206141_0; flowbits: unset, FB206141_0; flowbits: set, FB206141_1; classtype: trojan-activity; metadata: created_at 2017_8_29; reference: url, github.com/ptresearch/AttackDetection; sid: 11001882; rev: 1;) 

alert tcp $EXTERNAL_NET !$HTTP_PORTS -> $HOME_NET any (msg: "MALWARE [PTsecurity] RemoteAdmin.RemoteUtilities pkt checker #2"; flow: established, to_client; dsize: 4; content: "|0000|"; depth:2; stream_size: server, >,0; stream_size: server, <,6; stream_size: client, >,0; stream_size: client, <,10; flowbits: noalert; flowbits: isset, FB206141_1; flowbits: unset, FB206141_1; flowbits: set, FB206141_2; classtype: trojan-activity; metadata: created_at 2017_8_29; reference: url, github.com/ptresearch/AttackDetection; sid: 11001883; rev: 1;) 

alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] RemoteAdmin.RemoteUtilities pkt checker #3"; flow: established, to_server; dsize: 4; content: "|0000|"; depth:2; stream_size: server, >,0; stream_size: server, <,6; stream_size: client, >,0; stream_size: client, <,14; flowbits: noalert; flowbits: isset, FB206141_2; flowbits: unset, FB206141_2; flowbits: set, FB206141_3; classtype: trojan-activity; metadata: created_at 2017_8_29; reference: url, github.com/ptresearch/AttackDetection; sid: 11001884; rev: 1;) 

alert tcp $EXTERNAL_NET !$HTTP_PORTS -> $HOME_NET any (msg: "MALWARE [PTsecurity] Win32/RemoteAdmin.RemoteUtilities pkt checker #4"; flow: established, to_client; dsize: 4; content: "|0000|"; depth:2; stream_size: server, >,0; stream_size: server, <,14; stream_size: client, >,0; stream_size: client, <,22; flowbits: isset, FB206141_3; flowbits: unset, FB206141_3; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: created_at 2017_8_29; reference: url, github.com/ptresearch/AttackDetection; sid: 11001885; rev: 1;) 



##########################  Adwind RAT

alert  tls $EXTERNAL_NET any -> $HOME_NET any ( msg: "MALWARE [PTsecurity] Backdoor.Java.Adwind.cu Certificate flowbit set 1"; flow: established, to_client;content: "|3082|";depth:300; content: "|3082|";distance:2;within:2; content: "|a00302010202|";distance:2;within:6; flowbits: set, FB332502_; flowbits: noalert; threshold: type limit, track by_src, count 1, seconds 30;  metadata: former_category TROJAN; reference:md5,56e42156a1676b34f5350c01e34875d1; classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 21024751; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_21, malware_family Adwind, performance_impact Moderate, updated_at 2018_01_30;)

alert  tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdoor.Java.Adwind.cu pkt Checker flowbit set 2"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0040|"; distance:1; within:2; fast_pattern; stream_size: server, >,1689; stream_size: server, <,2124; stream_size: client, >,447; stream_size: client, <,1722; flowbits: isset, FB332502_; flowbits: set, FB332502_0; flowbits: noalert;  metadata: former_category TROJAN; reference:md5,56e42156a1676b34f5350c01e34875d1; classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 21024752; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_21, malware_family Adwind, performance_impact Moderate, updated_at 2018_01_30;)

alert  tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Backdoor.Java.Adwind.cu pkt Checker flowbit set 3";flow: established, to_client;content: "|1703|"; depth:2;content: "|0040|"; distance:1; within:2; fast_pattern;stream_size: server, >,1658;stream_size: server, <,2124;stream_size: client, >,447;stream_size: client, <,4222;flowbits: isset, FB332502_0;flowbits: unset, FB332502_0;flowbits: set, FB332502_1; flowbits: noalert; metadata: former_category TROJAN; reference:md5,56e42156a1676b34f5350c01e34875d1;classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 21024753; rev:4;metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_21, malware_family Adwind, performance_impact Moderate, updated_at 2018_01_30;)

alert  tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdoor.Java.Adwind.cu pkt Checker flowbit set 4"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,900, 1, relative; byte_test: 2, <=,1100, 1, relative; stream_size: server,  >,1758; stream_size: server, <,2124; stream_size: client, >,1376; stream_size: client, <,5922; flowbits: isset, FB332502_1; flowbits: unset, FB332502_1; flowbits: set, FB332502_2; flowbits: noalert;  metadata: former_category TROJAN; reference:md5,56e42156a1676b34f5350c01e34875d1; classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 21024754; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_21, malware_family Adwind, performance_impact Moderate, updated_at 2018_01_30;)

alert  tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Backdoor.Java.Adwind.cu pkt Checker flowbit set 5"; flow: established, to_client; content: "|1703|"; depth:2; content: "|0050|"; distance:1; within:2; fast_pattern; stream_size: server, >,1843; stream_size: server, <,2924; stream_size: client, >,1476; stream_size: client, <,8722; flowbits: isset, FB332502_2; flowbits: unset, FB332502_2; flowbits: set, FB332502_3; flowbits: noalert; metadata: former_category TROJAN; reference:md5,56e42156a1676b34f5350c01e34875d1; classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 21024755; rev:4; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_21, malware_family Adwind, performance_impact Moderate, updated_at 2018_02_14;)

alert  tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Backdoor.Java.Adwind.cu"; flow: established, to_client; content: "|1703|"; depth:2; content: "|0050|"; distance:1; within:2; fast_pattern; stream_size: server, >,1843; stream_size: server, <,3036; stream_size: client, >,1476; stream_size: client, <,8834; flowbits: isset, FB332502_3; flowbits: unset, FB332502_3; threshold: type limit, track by_src, count 1, seconds 30; metadata: former_category TROJAN; reference:md5,56e42156a1676b34f5350c01e34875d1; classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 21024756; rev:4; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_21, malware_family Adwind, performance_impact Moderate, updated_at 2018_02_14;)


###########################  Cobalt Strike

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Suspicious SSL connection - Observed in Cobalt Strike pkt checker #1"; flow: established, to_client; dsize: 907; stream_size: server, >,800; stream_size: server, <,1200; stream_size: client, >,100; stream_size: client, <,200; content: "|1603|"; depth:2; flowbits: noalert; flowbits: set, FB363347_1; classtype: trojan-activity; metadata: created_at 2017_10_15; reference: url, github.com/ptresearch/AttackDetection; sid: 11002070; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Suspicious SSL connection - Observed in Cobalt Strike pkt checker #2"; flow: established, to_server; dsize: 326; stream_size: server, >,800; stream_size: server, <,1200; stream_size: client, >,100; stream_size: client, <,500; content: "|1603|"; depth:2; flowbits: noalert; flowbits: isset, FB363347_1; flowbits: unset, FB363347_1; flowbits: set, FB363347_2; classtype: trojan-activity; metadata: created_at 2017_10_15; reference: url, github.com/ptresearch/AttackDetection; sid: 11002071; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Suspicious SSL connection - Observed in Cobalt Strike pkt checker #3"; flow: established, to_client; dsize: 6; stream_size: server, >,800; stream_size: server, <,1200; stream_size: client, >,100; stream_size: client, <,500; content: "|1403|"; depth:2; flowbits: noalert; flowbits: isset, FB363347_2; flowbits: unset, FB363347_2; flowbits: set, FB363347_3; classtype: trojan-activity; metadata: created_at 2017_10_15; reference: url, github.com/ptresearch/AttackDetection; sid: 11002072; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Suspicious SSL connection - Observed in Cobalt Strike pkt checker #4"; flow: established, to_client; dsize: 53; stream_size: server, >,800; stream_size: server, <,1200; stream_size: client, >,100; stream_size: client, <,500; content: "|1603|"; depth:2; flowbits: noalert; flowbits: isset, FB363347_3; flowbits: unset, FB363347_3; flowbits: set, FB363347_4; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: created_at 2017_10_15; reference: url, github.com/ptresearch/AttackDetection; sid: 11002073; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Suspicious SSL connection - Observed in Cobalt Strike"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,128, 1, relative; byte_test: 2, <=,200, 1, relative; stream_size: server, >,800; stream_size: server, <,3019; stream_size: client, >,100; stream_size: client, <,1318; flowbits: isset, FB363347_4; flowbits: unset, FB363347_4; flowbits: set, FB363347_5; classtype: trojan-activity; metadata: created_at 2017_10_15; reference: url, github.com/ptresearch/AttackDetection; sid: 11002074; rev: 1;) 


#######################   Orcus RAT

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Observed Malicious SSL Certificate (Orcus RAT)";flow: established, to_client;content: "|a003 0201 0202 10|";depth:600;threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; flowbits: noalert; flowbits: set, FB369639_;metadata: created_at 2017_10_24; reference: url, github.com/ptresearch/AttackDetection; sid: 11002134;rev: 2;)

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious SSL connection (Orcus RAT) pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0020|"; distance:1; within:2; fast_pattern; stream_size: server, <,999; stream_size: server, >,1; stream_size: client, >,250; stream_size: client, <,355; flowbits: noalert; flowbits: isset, FB369639_; flowbits: unset, FB369639_; flowbits: set, FB369639_0; classtype: trojan-activity; metadata: created_at 2017_10_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11002135; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious SSL connection (Orcus RAT)";flow: established, to_server;content: "|1703|"; depth:2;content: "|0020|"; distance:1; within:2; fast_pattern;stream_size: server, <,1200;stream_size: server, >,700;stream_size: client, >,200;stream_size: client, <,600;flowbits: isset, FB369639_0;flowbits: unset, FB369639_0;threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity;metadata: created_at 2017_10_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11002136; rev: 2;) 


############################  Malicious SSL connection (Upatre Downloader CnC) multipath detect
#            0xa0(160) -- 0x0140(320) - 0x04a0(1184) - #AlertTLS
#          /                  /
#  cert -- 0xb0(176) -- 0x0200(512) - #RST
#       
#

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Malicious SSL connection (Formbook/Upatre Downloader CnC) cert"; flow: established, to_client; content: "|3082|"; depth:300; content: "|a00302010202|"; distance:6; within:6; fast_pattern; flowbits: set, FB346039_0; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_9_24; reference: url, github.com/ptresearch/AttackDetection; sid: 11001978; rev: 1;)

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious SSL connection (Formbook/Upatre Downloader CnC) #0"; flow: established, to_server; content: "|1703|"; depth:2; content: "|00A0|"; distance:1; within:2; fast_pattern; stream_size: server, >,4868; stream_size: server, <,5949; stream_size: client, >,424; stream_size: client, <,685; flowbits: isset, FB346039_0; flowbits: unset, FB346039_0; flowbits: set, FB346039_1; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_9_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11001979; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious SSL connection (Formbook/Upatre Downloader CnC) #0"; flow: established, to_server; content: "|1703|"; depth:2; content: "|00B0|"; distance:1; within:2; fast_pattern; stream_size: client, >,424; stream_size: client, <,685; flowbits: isset, FB346039_0; flowbits: unset, FB346039_0; flowbits: set, FB346039_1; flowbits: set, FB346039_2; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_9_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11001980; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Malicious SSL connection (Formbook/Upatre Downloader CnC)"; flow: established, to_client; content: "|1703|"; depth:2; content: "|0140|"; distance:1; within:2;  content: "|1703|"; distance: 320; within:2; content: "|04A0|"; distance:1; within:2; fast_pattern; stream_size: server, >,5000; stream_size: server, <,10069; stream_size: client, >,424; stream_size: client, <,905; flowbits: isset, FB346039_1; flowbits: unset, FB346039_1; flowbits: unset, FB346039_2; flowbits: set, FB346039_3; classtype: trojan-activity; metadata: created_at 2017_9_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11001981; rev: 1;)

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Malicious SSL connection (Formbook/Upatre Downloader CnC)"; flow: established, to_client; content: "|1703|"; depth:2; content: "|0200|"; distance:1; within:2; fast_pattern; stream_size: server, >,5000; stream_size: server, <,6500; stream_size: client, >,424; stream_size: client, <,905; flowbits: isset, FB346039_2; flowbits: unset, FB346039_2; classtype: trojan-activity; metadata: created_at 2017_9_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11001983; rev: 1;)

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Malicious SSL connection (Formbook/Upatre Downloader CnC)";flow: established, to_client;content: "|1703|"; depth:2;content: "|0170|"; distance:1; within:2; fast_pattern;stream_size: server, >,5000;stream_size: server, <,12500;stream_size: client, >,424;stream_size: client, <,905;flowbits: isset, FB346039_2;flowbits: unset, FB346039_2;classtype: trojan-activity;metadata: created_at 2017_9_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11001984; rev: 2;)


############################## APT28 Uploader SSL connection pkt checker 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] APT28 Uploader SSL connection pkt checker #0.1"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0170|"; distance:1; within:2; fast_pattern;stream_size: server, >,998; stream_size: server, <,1700; stream_size: client, >,722; stream_size: client, <,18767; flowbits: noalert;flowbits: set, FB424249_0; classtype: trojan-activity; metadata: created_at 2017_12_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11002276; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] APT28 Uploader SSL connection pkt checker #0.2"; flow: established, to_server; content: "|1703|"; depth:2; content: "|01a0|"; distance:1; within:2; fast_pattern;stream_size: server, >,998; stream_size: server, <,1700; stream_size: client, >,722; stream_size: client, <,18767; flowbits: noalert;flowbits: set, FB424249_0; classtype: trojan-activity; metadata: created_at 2017_12_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11002278; rev: 1;)

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] APT28 Uploader SSL connection pkt checker #1"; flow: established, to_server; content: "|1703|"; depth:2; content: "|3FF0|"; distance:1; within:2; fast_pattern;stream_size: server, >,998; stream_size: server, <,16469; stream_size: client, >,2182; stream_size: client, <,35135; flowbits: isset, FB424249_0; flowbits: unset, FB424249_0; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2017_12_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11002277; rev: 1;) 

######################## Shurl0ckr TOR

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] W97M.Cerber/Shurl0ckr TOR connection pkt checker #0"; flow: established, to_server; content: "|17030300AB|"; depth:5; fast_pattern; stream_size: server, >,2757; stream_size: server, <,4534; stream_size: client, >,390; stream_size: client, <,1123; flowbits: noalert; flowbits: set, FB405091_0; classtype: trojan-activity; metadata: created_at 2018_1_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11002279; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] W97M.Cerber/Shurl0ckr TOR connection pkt checker #1"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,220, 1, relative; byte_test: 2, <=,245, 1, relative; stream_size: server, >,3434; stream_size: server, <,4534; stream_size: client, >,390; stream_size: client, <,1123;  flowbits: noalert; flowbits: isset, FB405091_0; flowbits: unset, FB405091_0; flowbits: set, FB405091_1; classtype: trojan-activity; metadata: created_at 2018_1_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11002280; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] W97M.Cerber/Shurl0ckr TOR connection pkt checker #2"; flow: established, to_server; content: "|17030300AB|"; depth:5; fast_pattern; stream_size: server, >,3434; stream_size: server, <,4534; stream_size: client, >,566; stream_size: client, <,1123;  flowbits: noalert; flowbits: isset, FB405091_1; flowbits: unset, FB405091_1; flowbits: set, FB405091_2; classtype: trojan-activity; metadata: created_at 2018_1_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11002281; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] W97M.Cerber/Shurl0ckr TOR connection pkt checker #3"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,220, 1, relative; byte_test: 2, <=,245, 1, relative; stream_size: server, >,4112; stream_size: server, <,4534; stream_size: client, >,566; stream_size: client, <,1123;  flowbits: noalert; flowbits: isset, FB405091_2; flowbits: unset, FB405091_2; flowbits: set, FB405091_3; classtype: trojan-activity; metadata: created_at 2018_1_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11002282; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] W97M.Cerber/Shurl0ckr TOR connection pkt checker #4"; flow: established, to_server; content: "|17030300AB|"; depth:5; fast_pattern; stream_size: server, >,4112; stream_size: server, <,5305; stream_size: client, >,742; stream_size: client, <,1294; flowbits: isset, FB405091_3; flowbits: unset, FB405091_3; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2018_1_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11002283; rev: 1;) 


######################### Ursnif 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE [PTsecurity] Ursnif Malicious SSL detect pkt checker #0";flow:established,from_server; content:"|09 00 C1 0E 3F 17 BC 2F BE 83|"; depth: 300; content:"|55 04 08|"; distance:0; content:"|0A|Some-State"; distance:1; within:11; content:"|55 04 0A|"; distance:0; content:"|18|Internet Widgits Pty Ltd"; distance:1; within:25; fast_pattern; flowbits: set, FB449906_; flowbits: noalert; reference:md5,65dae76418fa23277068a00e6a0199d; classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11002454; rev:1; metadata:attack_target Client_Endpoint, deployment Perimeter,tag SSL_Malicious_Cert, signature_severity Major, created_at 2018_01_18;)

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Ursnif Malicious SSL Connection Detected pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0130|"; distance:1; within:2; fast_pattern;stream_size: server, >,934; stream_size: server, <,2772; stream_size: client, >,630; stream_size: client, <,1540; flowbits: noalert; flowbits: isset, FB449906_; flowbits: set, FB449906_0; classtype: trojan-activity; metadata: created_at 2018_1_18; reference: url, github.com/ptresearch/AttackDetection; sid: 11002450; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Ursnif Malicious SSL Connection Detected pkt checker #1"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0160|"; distance:1; within:2; fast_pattern;stream_size: server, >,934; stream_size: server, <,2772; stream_size: client, >,987; stream_size: client, <,1540; flowbits: noalert; flowbits: isset, FB449906_0; flowbits: unset, FB449906_0; flowbits: set, FB449906_1; classtype: trojan-activity; metadata: created_at 2018_1_18; reference: url, github.com/ptresearch/AttackDetection; sid: 11002451; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Ursnif Malicious SSL Connection Detected"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,352, 1, relative; byte_test: 2, <=,816, 1, relative; stream_size: server, >,1291; stream_size: server, <,3588; stream_size: client, >,987; stream_size: client, <,2356; flowbits: isset, FB449906_1; flowbits: unset, FB449906_1; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2018_1_18; reference: url, github.com/ptresearch/AttackDetection; sid: 11002452; rev: 1;) 

############################# Shifr/Shurl0cker

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE [PTsecurity] Onion.casa SSL Certificate Observed"; content: "|30 3A 31 21 30 1F 06 0355 04 0B 13 18 44 6F 6D  61 69 6E 20 43 6F 6E 7472 6F 6C 20 56 61 6C 69  64 61 74 65 64 31 15 3013 06 03 55 04 03 0C 0C  2A 2E 6F 6E 69 6F 6E 2E63 61 73 61|"; flowbits: set,FB513376_; flowbits: noalert; classtype: policy-violation; metadata: created_at 2018_3_13; reference: url, github.com/ptresearch/AttackDetection; sid: 11002667;)

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Shifr/Shurl0cker Ransomware SSL connection pkt checker #0";flow: established, to_client;content: "|17 03 03 00 40|"; depth:5; fast_pattern;stream_size: server, >,3407; stream_size: server, <,3679; stream_size: client, >,290; stream_size: client, <,672;flowbits: isset,FB513376_;flowbits: set,FB513376_0;flowbits: unset,FB513376_;flowbits: noalert; classtype: trojan-activity;metadata: created_at 2018_3_9; reference: url, github.com/ptresearch/AttackDetection; sid: 11002659; rev: 1;)

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Shifr/Shurl0cker Ransomware SSL connection pkt checker #1"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0058|"; distance:1; within:2; fast_pattern;stream_size: server, >,3407; stream_size: server, <,3679; stream_size: client, >,383; stream_size: client, <,672; flowbits: noalert; flowbits: isset, FB513376_0; flowbits: unset, FB513376_0; flowbits: set, FB513376_1; classtype: trojan-activity; metadata: created_at 2018_3_9; reference: url, github.com/ptresearch/AttackDetection; sid: 11002660; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Shifr/Shurl0cker Ransomware SSL connection pkt checker #2";flow: established, to_client;content: "|1703|"; depth:2;content: "|0021|"; distance:1; within:2; fast_pattern;stream_size: server, >,2000;stream_size: server, <,5000;stream_size: client, >,538;stream_size: client, <,705;flowbits: isset, FB513376_1;flowbits: unset, FB513376_1;threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity;metadata: created_at 2018_3_9; reference: url, github.com/ptresearch/AttackDetection; sid: 11002661; rev: 1;) 

############################## Malicious redirect SSL

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious redirect SSL (urlz.fr) pkt checker #0"; flow: established, to_server; content: "|17030100D0|"; depth:15; fast_pattern; stream_size: server, >,4561; stream_size: server, <,5925; stream_size: client, >,559; stream_size: client, <,1794; flowbits: noalert;flowbits: set, FB507762_0; classtype: trojan-activity; metadata: created_at 2018_3_7; reference: url, github.com/ptresearch/AttackDetection; sid: 11002647; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Malicious redirect SSL (urlz.fr) pkt checker #1"; flow: established, to_client; content: "|1703010160|"; depth:15; fast_pattern; stream_size: server, >,4950; stream_size: server, <,5925; stream_size: client, >,559; stream_size: client, <,1794; flowbits: noalert; flowbits: isset, FB507762_0; flowbits: unset, FB507762_0; flowbits: set, FB507762_1; classtype: trojan-activity; metadata: created_at 2018_3_7; reference: url, github.com/ptresearch/AttackDetection; sid: 11002648; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious redirect SSL (urlz.fr) pkt checker #2"; flow: established, to_server; content: "|17030100D0|"; depth:15; fast_pattern; stream_size: server, >,4950; stream_size: server, <,5925; stream_size: client, >,788; stream_size: client, <,1794; flowbits: noalert; flowbits: isset, FB507762_1; flowbits: unset, FB507762_1; flowbits: set, FB507762_2; classtype: trojan-activity; metadata: created_at 2018_3_7; reference: url, github.com/ptresearch/AttackDetection; sid: 11002649; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Malicious redirect SSL (urlz.fr) pkt checker #3"; flow: established, to_client; content: "|1703010160|"; depth:15; fast_pattern; stream_size: server, >,5307; stream_size: server, <,5925; stream_size: client, >,788; stream_size: client, <,1794; flowbits: isset, FB507762_2; flowbits: unset, FB507762_2; flowbits: set, FB507762_3; classtype: trojan-activity; metadata: created_at 2018_3_7; reference: url, github.com/ptresearch/AttackDetection; sid: 11002650; rev: 1;) 

#################### Dyre/Trickbot/Dridex TLSv1.0

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex TLSv1.0 connection pkt checker #0"; flow: established, to_server; content: "|1703010020|"; depth:5; fast_pattern; content: "|1703|"; distance:32; within: 2; stream_size: server, >,1378; stream_size: server, <,3413; stream_size: client, >,419; stream_size: client, <,1488; flowbits: noalert;flowbits: set, FB550954_0; classtype: trojan-activity; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002811; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex TLSv1.0 connection pkt checker #1"; flow: established, to_client; content: "|1703|"; depth:2; content: "|01A0|"; distance:1; within:2; fast_pattern;stream_size: server, >,1799; stream_size: server, <,3413; stream_size: client, >,419; stream_size: client, <,1488; flowbits: noalert; flowbits: isset, FB550954_0; flowbits: unset, FB550954_0; flowbits: set, FB550954_1; classtype: trojan-activity; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002812; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex TLSv1.0 connection pkt checker #2"; flow: established, to_server; content: "|1703010020|"; depth:5; fast_pattern; content: "|1703|"; distance:32; within: 2; stream_size: server, >,1799; stream_size: server, <,3413; stream_size: client, >,829; stream_size: client, <,1488; flowbits: noalert; flowbits: isset, FB550954_1; flowbits: unset, FB550954_1; flowbits: set, FB550954_2; classtype: trojan-activity; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002813; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex TLSv1.0 connection pkt checker #3"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,656, 1, relative; byte_test: 2, <=,704, 1, relative; stream_size: server, >,2460; stream_size: server, <,3413; stream_size: client, >,829; stream_size: client, <,1488; flowbits: noalert; flowbits: isset, FB550954_2; flowbits: unset, FB550954_2; flowbits: set, FB550954_3; classtype: trojan-activity; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002814; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex TLSv1.0 connection pkt checker #4";flow: established, to_server; content: "|1703010020|"; depth:5; fast_pattern; content: "|1703|"; distance:32; within: 2; stream_size: server, >,2460;stream_size: server, <,3445;stream_size: client, >,1127;stream_size: client, <,1620;flowbits: isset, FB550954_3;flowbits: unset, FB550954_3;threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity;metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002815; rev: 1;) 

####################### LanternVPN

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] LanternVPN connection pkt checker #0"; flow: established, to_server; dsize: 512<>728; stream_size: server, =,1; stream_size: client, <,729; flowbits: noalert; flowbits: set, FB550953_0; classtype: policy-violation; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002816; rev: 1;) 

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] LanternVPN connection pkt checker #1"; flow: established, to_client; dsize: 73; stream_size: server, =,74; stream_size: client, >,511; stream_size: client, <,729; flowbits: noalert; flowbits: isset, FB550953_0; flowbits: unset, FB550953_0; flowbits: set, FB550953_1; classtype: policy-violation; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002817; rev: 1;) 

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] LanternVPN connection pkt checker #2"; flow: established, to_client; dsize: 34; stream_size: server, =,108; stream_size: client, >,511; stream_size: client, <,729; flowbits: noalert; flowbits: isset, FB550953_1; flowbits: unset, FB550953_1; flowbits: set, FB550953_2; classtype: policy-violation; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002818; rev: 1;) 

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] LanternVPN connection pkt checker #3"; flow: established, to_client; dsize: 62; stream_size: server, =,170; stream_size: client, >,511; stream_size: client, <,729; flowbits: noalert; flowbits: isset, FB550953_2; flowbits: unset, FB550953_2; flowbits: set, FB550953_3; classtype: policy-violation; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002819; rev: 1;)

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] LanternVPN connection pkt checker #4"; flow: established, to_client; dsize: 40; stream_size: server, =,210; stream_size: client, >,511; stream_size: client, <,729; flowbits: isset, FB550953_3; flowbits: unset, FB550953_3; classtype: policy-violation; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002820; rev: 1;)


############  Ursnif


alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Win32/Spy.Ursnif SSL TOR activity pkt checker #0"; flow: established, to_server; content: "|1703 01 0020|"; depth:5; fast_pattern;stream_size: server, >,954; stream_size: server, <,3863; stream_size: client, >,166; stream_size: client, <,2558; flowbits: noalert; flowbits: isset, FB0_01; flowbits: set, FB447357_0; classtype: trojan-activity; metadata: created_at 2018_1_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002430; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Win32/Spy.Ursnif SSL TOR activity pkt checker #1"; flow: established, to_client; content: "|1703 01 0020|"; depth:5;  fast_pattern; content: "|1703|"; distance:32; within:2; stream_size: server, >,2414; stream_size: server, <,3863; stream_size: client, >,166; stream_size: client, <,2558; flowbits: noalert; flowbits: isset, FB447357_0; flowbits: unset, FB447357_0; flowbits: set, FB447357_1; classtype: trojan-activity; metadata: created_at 2018_1_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002431; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Win32/Spy.Ursnif SSL TOR activity pkt checker #2"; flow: established, to_server; content: "|1703 01 0220|"; depth:5;  fast_pattern;stream_size: server, >,3044; stream_size: server, <,3863; stream_size: client, >,715; stream_size: client, <,2558; flowbits: noalert; flowbits: isset, FB447357_1; flowbits: unset, FB447357_1; flowbits: set, FB447357_2; classtype: trojan-activity; metadata: created_at 2018_1_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002432; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Win32/Spy.Ursnif SSL TOR activity pkt checker #3"; flow: established, to_client; content: "|1703 01 0020|"; depth:5;  fast_pattern;content: "|1703|"; distance:32; within:2; stream_size: server, >,3630; stream_size: server, <,3863; stream_size: client, >,1264; stream_size: client, <,2558; flowbits: noalert; flowbits: isset, FB447357_2; flowbits: unset, FB447357_2; flowbits: set, FB447357_3; classtype: trojan-activity; metadata: created_at 2018_1_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002433; rev: 1;)

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Win32/Spy.Ursnif SSL TOR activity"; flow: established, to_server; content: "|1703 01 0220|"; depth:5;  fast_pattern;stream_size: server, >,3630; stream_size: server, <,4407; stream_size: client, >,1813; stream_size: client, <,3102; flowbits: isset, FB447357_3; flowbits: unset, FB447357_3; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2018_1_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002434; rev: 1;) 


############# TrickBot


alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] TrickBot.Spy SSL connection cert";flow: established, to_client;content: "|308203|";depth: 600;content: "|308202|";distance:1;within:3;content: "|a003020102020900|";distance:1;within:8;flowbits: noalert; flowbits: set, FB566923_;threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity;metadata: created_at 2018_5_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11002938; rev: 1;)

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TrickBot.Spy SSL connection pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,240, 1, relative; byte_test: 2, <=,288, 1, relative; stream_size: server, >,1278; stream_size: server, <,3797; stream_size: client, >,374; stream_size: client, <,1657; flowbits: noalert; flowbits: isset, FB566923_; flowbits: unset, FB566923_; flowbits: set, FB566923_0; classtype: trojan-activity; metadata: created_at 2018_05_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11002939; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] TrickBot.Spy SSL connection pkt checker #1"; flow: established, to_client; content: "|1703|"; depth:2; content: "|01A0|"; distance:1; within:2; fast_pattern;stream_size: server, >,1699; stream_size: server, <,3797; stream_size: client, >,374; stream_size: client, <,1657; flowbits: noalert; flowbits: isset, FB566923_0; flowbits: unset, FB566923_0; flowbits: set, FB566923_1; classtype: trojan-activity; metadata: created_at 2018_05_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11002940; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TrickBot.Spy SSL connection pkt checker #2"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,368, 1, relative; byte_test: 2, <=,416, 1, relative; stream_size: server, >,1699; stream_size: server, <,3797; stream_size: client, >,747; stream_size: client, <,1657; flowbits: noalert; flowbits: isset, FB566923_1; flowbits: unset, FB566923_1; flowbits: set, FB566923_2; classtype: trojan-activity; metadata: created_at 2018_05_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11002941; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] TrickBot.Spy SSL connection pkt checker #3"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,704, 1, relative; byte_test: 2, <=,896, 1, relative; stream_size: server, >,2488; stream_size: server, <,3797; stream_size: client, >,747; stream_size: client, <,1657; flowbits: noalert; flowbits: isset, FB566923_2; flowbits: unset, FB566923_2; flowbits: set, FB566923_3; classtype: trojan-activity; metadata: created_at 2018_05_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11002942; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TrickBot.Spy SSL connection"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,256, 1, relative; byte_test: 2, <=,304, 1, relative; stream_size: server, >,2488; stream_size: server, <,4101; stream_size: client, >,1008; stream_size: client, <,1961; flowbits: isset, FB566923_3; flowbits: unset, FB566923_3; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2018_05_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11002943; rev: 1;) 

################### Ozon RAT

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Ozone RAT connection";flow: established, to_server; dsize:6;content: "|0000 00|";fast_pattern;offset:2;depth: 3;content:"|01|";offset:0;depth:1;byte_test:1,>,0x10,1;byte_test:1,<,0xf0,1;stream_size: server, =, 1;stream_size: client, =, 7;classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11000431; rev: 4;)

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Ozone RAT connection pkt#0";flow: established, to_server; dsize: 6;content: "|0000 00|";fast_pattern;offset:2;depth: 3;content:"|01|";offset:0;depth:1;byte_test:1,>,0x06,1;byte_test:1,<,0xf0,1;stream_size: server, =,1;stream_size: client, =,7;flowbits: noalert;flowbits: set, FB582528_0;classtype: trojan-activity;metadata: created_at 2018_05_24; reference: url, github.com/ptresearch/AttackDetection; sid: 11003004; rev: 1;) 

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Ozone RAT connection";flow: established, to_client;dsize: 6;stream_size: server, >,0;stream_size: server, <,54;stream_size: client, >,0;stream_size: client, <,650;content: "|0100 0000|";fast_pattern; depth: 4;flowbits: isset, FB582528_0;flowbits: unset, FB582528_0;classtype: trojan-activity;metadata: created_at 2018_05_24; reference: url, github.com/ptresearch/AttackDetection; sid: 11003005; rev: 1;)


######################## Backdoor.Zegost

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Win32.Backdoor.Zegost.Auto connection pkt checker #0";flow: established, to_server; dsize: 473;stream_size: server, =,1;stream_size: client, =,474;pcre:"/[\x0e-\x19\x80-\xff]{5}/";flowbits: noalert;flowbits: set, FB582249_0;classtype: trojan-activity;metadata: created_at 2018_05_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11003000; rev: 1;) 

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Win32.Backdoor.Zegost.Auto connection";flow: established, to_client; dsize: 18;stream_size: server, =,19;stream_size: client, =,474;flowbits: isset, FB582249_0;flowbits: unset, FB582249_0;classtype: trojan-activity;metadata: created_at 2018_05_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11003001; rev: 1;) 


############################################################### Ursnif/Gozi SSL

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Ursnif/Gozi SSL certificate";flow: established, to_client;content: "Some-State1";depth:300;fast_pattern;flowbits: set, FB625629_;flowbits: noalert;threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity;metadata: created_at 2018_08_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11003532; rev: 1;)

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Ursnif/Gozi SSL certificate pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0140|"; distance:1; within:2; fast_pattern;stream_size: server, >,934; stream_size: server, <,1844; stream_size: client, >,646; stream_size: client, <,1492;  flowbits: isset, FB625629_; flowbits: unset, FB625629_; flowbits: noalert; flowbits: set, FB625629_0; classtype: trojan-activity; metadata: created_at 2018_08_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11003533; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Ursnif/Gozi SSL certificate pkt checker #1"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0140|"; distance:1; within:2; fast_pattern;stream_size: server, >,934; stream_size: server, <,1844; stream_size: client, >,971; stream_size: client, <,1492;  flowbits: isset, FB625629_0; flowbits: unset, FB625629_0; flowbits: noalert; flowbits: set, FB625629_1; classtype: trojan-activity; metadata: created_at 2018_08_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11003534; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Ursnif/Gozi SSL connection"; flow: established, to_client; content: "|1703|"; depth:2; content: "|0160|"; distance:1; within:2; fast_pattern;stream_size: server, >,1291; stream_size: server, <,2196; stream_size: client, >,971; stream_size: client, <,1844; flowbits: isset, FB625629_1; flowbits: unset, FB625629_1; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2018_08_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11003535; rev: 1;) 

############################################## Malicious SSL Connection (APT32) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Possible Observed Malicious SSL Cert (APT32)"; flow: established, to_client; content: "|300d06092a864886f70d01010b0500304a310b300906035504061302555331163014060355040a130d4c6574277320456e6372797074312330210603550403131a4c6574277320456e637279707420417574686f72697479205833301e170d313830|"; depth:300; flowbits: noalert; flowbits: set, FB658819_;classtype: trojan-activity; metadata: created_at 2018_8_21; reference: url, github.com/ptresearch/AttackDetection; sid: 11003554; rev: 1;)

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Possible Observed Malicious SSL Cert (APT32)pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0150|"; distance:1; within:2; fast_pattern;stream_size: server, >,2793; stream_size: server, <,21028; stream_size: client, >,603; stream_size: client, <,1236; flowbits: noalert; flowbits: isset, FB658819_; flowbits: unset, FB658819_; flowbits: set, FB658819_0; classtype: trojan-activity; metadata: created_at 2018_08_21; reference: url, github.com/ptresearch/AttackDetection; sid: 11003555; rev: 1;)

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Possible Observed Malicious SSL Connection (APT32)"; flow: established, to_client; content: "|1703|"; depth:2; content: "|0090|"; distance:1; within:2; fast_pattern; stream_size: server, >,2942; stream_size: server, <,37492; stream_size: client, >,603; stream_size: client, <,17700; flowbits: isset, FB658819_0; flowbits: unset, FB658819_0; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2018_08_21; reference: url, github.com/ptresearch/AttackDetection; sid: 11003556; rev: 1;) 



############################### Lethic

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Win32/Lethic.AF connection pkt checker #0";flow: established, to_client; dsize: 5;stream_size: server, <,40;stream_size: client, <,20;content: "|0000 0000 06|"; depth: 6; flowbits: noalert; flowbits: set, FB663513_0;classtype: trojan-activity;metadata: created_at 2018_08_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11003608; rev: 1;) 

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Win32/Lethic.AF connection pkt checker #1";flow: established, to_client; dsize: 11;stream_size: server, <,40;stream_size: client, <,20;content: "|0001|"; offset: 3; depth: 2; flowbits: noalert; flowbits: isset, FB663513_0;flowbits: unset, FB663513_0;flowbits: set, FB663513_1;classtype: trojan-activity;metadata: created_at 2018_08_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11003609; rev: 1;) 

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Win32/Lethic.AF";flow: established, to_server; dsize: 6;stream_size: server, <,40;stream_size: client, <,26;content: "|0021|"; offset: 3; depth: 2;flowbits: isset, FB663513_1;flowbits: unset, FB663513_1;classtype: trojan-activity;metadata: created_at 2018_08_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11003610; rev: 1;) 

################################ GandCrab

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] GandCrab v.5 SSL Cert";flow: established, to_client;content: "|3082|";depth: 600;content: "Let's Encrypt1"; distance: 0;flowbits: noalert;flowbits: set, FB709724_;classtype: trojan-activity;metadata: created_at 2018_10_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11003915; rev: 2;)

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] GandCrab v.5 SSL Connection";flow: established, to_server;content: "|1703 01 0340|"; depth:5;stream_size: server, <,3923;stream_size: client, <,2001;flowbits: isset, FB709724_;flowbits: unset, FB709724_;flowbits: set, FB709724_0; flowbits: noalert; classtype: trojan-activity;metadata: created_at 2018_10_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11003916; rev: 2;)

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] GandCrab v.5 SSL Connection";flow: established, to_client;content: "|1703 01 0140|"; depth:5;stream_size: server, <,4723;stream_size: client, <,3501;flowbits: isset, FB709724_0;flowbits: unset, FB709724_0;classtype: trojan-activity;metadata: created_at 2018_10_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11003917; rev: 1;)


############################### Ranapama

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Trojan.Ranapama.JH pkt checker #0"; flow: established, to_server; dsize: 51<>58;stream_size: server, =,1;stream_size: client, >,0;stream_size: client, <,58; pcre: "/^(?:[\x1f-\x80])+$/"; flowbits: noalert; flowbits: set, FB710046_0; classtype: trojan-activity; metadata: created_at 2018_10_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11003921; rev: 1;) 

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Trojan.Ranapama.JH pkt checker #1";flow: established, to_client; dsize: 3;stream_size: server, =,4;stream_size: client, >,51;stream_size: client, <,58; pcre: "/^(?:[\x1f-\x80])+$/"; flowbits: noalert; flowbits: isset, FB710046_0;flowbits: unset, FB710046_0;flowbits: set, FB710046_1;classtype: trojan-activity;metadata: created_at 2018_10_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11003922; rev: 1;) 

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Trojan.Ranapama.JH"; flow: established, to_server; dsize: 2; stream_size: server, =,4; stream_size: client, >,53; stream_size: client, <,62; pcre: "/^(?:[\x1f-\x80])+$/"; flowbits: isset, FB710046_1; flowbits: unset, FB710046_1; classtype: trojan-activity; metadata: created_at 2018_10_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11003923; rev: 1;) 
